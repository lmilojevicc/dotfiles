#!/usr/bin/env bash

DEFAULT_MODEL="github-copilot/gpt-5-mini"

function ocli() {
    local model prompt agent show_model_picker=false

    while [[ $# -gt 0 ]]; do
        case $1 in
        -m | --model)
            show_model_picker=true
            shift
            ;;
        *)
            shift
            ;;
        esac
    done

    agent="cli-strict"

    if [[ "$show_model_picker" == true ]]; then
        echo "üß† Select model..."
        model=$(opencode models | fzf \
            --prompt="Model: " \
            --height=50% \
            --border \
            --reverse \
            --header="Press ESC to cancel") || return 1
        echo -e "üß† Using: $model"
    else
        model="$DEFAULT_MODEL"
        echo -e "üß† Using default model: $model\n‚ÑπÔ∏è Use -m to pick your prefered model"
    fi

    echo "üí¨ Enter your prompt:"
    read prompt

    echo -e "‚ö° Running: opencode run --agent $agent --model $model \"$prompt\""

    opencode run --agent "$agent" --model "$model" "$prompt"
}

ocli "$@"
